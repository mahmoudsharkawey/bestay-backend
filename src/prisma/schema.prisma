generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

//////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////

enum Role {
  USER
  LANDLORD
  ADMIN
}

enum BookingStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum AuthProvider {
  LOCAL
  GOOGLE
}

enum UnitType {
  ROOM
  APARTMENT
  STUDIO
}

enum RoomType {
  SINGLE
  DOUBLE
  SHARED
}

enum GenderPreference {
  MALE_ONLY
  FEMALE_ONLY
}

//////////////////////////////////////////////////
// USER
//////////////////////////////////////////////////

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String?
  phone     String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  provider   AuthProvider @default(LOCAL)
  providerId String?
  picture    String?

  passwordResetCode     String?
  passwordResetExpiry   DateTime?
  passwordResetVerified Boolean   @default(false)

  units       Unit[]          @relation("OwnerUnits")
  bookings    Booking[]
  preferences UserPreference?
  reviews     Review[]
  favorites   Favorite[]

  @@unique([provider, providerId])
}

//////////////////////////////////////////////////
// USER PREFERENCES (AI INPUT)
//////////////////////////////////////////////////

model UserPreference {
  id       String   @id @default(uuid())
  userId   String   @unique
  unitType UnitType

  minBudget   Float
  maxBudget   Float
  city        String
  university  String?
  maxDistance Float? // optional distance from university (km)

  rooms      Int
  furnished  Boolean
  genderType String // e.g., "male only", "female only"
  facilities String[] // e.g., ["wifi", "parking", "gym"]

  user User @relation(fields: [userId], references: [id])
}

//////////////////////////////////////////////////
// UNIT (PROPERTY LISTING)
//////////////////////////////////////////////////

model Unit {
  id          String  @id @default(uuid())
  title       String
  description String
  price       Float
  city        String
  address     String
  rooms       Int
  furnished   Boolean

  university String?
  distance   Float? // distance from university (km)

  isAvailable Boolean @default(true)

  roomType   RoomType
  genderType GenderPreference

  facilities String[] // e.g., ["wifi", "parking", "gym"]
  images     String[] // URLs of unit images

  ownerId String
  owner   User   @relation("OwnerUnits", fields: [ownerId], references: [id])

  latitude  Float?
  longitude Float?

  bookings  Booking[]
  reviews   Review[]
  favorites Favorite[]

  createdAt DateTime @default(now())
}

//////////////////////////////////////////////////
// BOOKING
//////////////////////////////////////////////////

model Booking {
  id        String        @id @default(uuid())
  userId    String
  unitId    String
  startDate DateTime
  endDate   DateTime
  status    BookingStatus @default(PENDING)

  user    User     @relation(fields: [userId], references: [id])
  unit    Unit     @relation(fields: [unitId], references: [id])
  payment Payment?

  createdAt DateTime @default(now())
}

//////////////////////////////////////////////////
// PAYMENT
//////////////////////////////////////////////////

model Payment {
  id        String        @id @default(uuid())
  bookingId String        @unique
  amount    Float
  status    PaymentStatus
  method    String // card, wallet, etc

  booking   Booking  @relation(fields: [bookingId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////////////////////////////////
// REVIEW
//////////////////////////////////////////////////

model Review {
  id      String  @id @default(uuid())
  rating  Int // 1â€“5
  comment String?

  userId String
  unitId String

  user User @relation(fields: [userId], references: [id])
  unit Unit @relation(fields: [unitId], references: [id])

  createdAt DateTime @default(now())
}

model Favorite {
  id     String @id @default(uuid())
  userId String
  unitId String

  user User @relation(fields: [userId], references: [id])
  unit Unit @relation(fields: [unitId], references: [id])

  @@unique([userId, unitId])

  createdAt DateTime @default(now())
}
